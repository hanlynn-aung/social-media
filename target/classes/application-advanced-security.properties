# Advanced Security Features Configuration

# ==========================================
# Rate Limiting Configuration
# ==========================================

# Enable/disable rate limiting
# Default: true (enabled)
spring.security.rate-limiting.enabled=true

# Rate limits per minute by role (customizable)
# Anonymous users (unauthenticated)
spring.security.rate-limiting.anonymous=10

# Regular authenticated users
spring.security.rate-limiting.user=60

# Shop administrators
spring.security.rate-limiting.shop-admin=100

# System administrators
spring.security.rate-limiting.admin=500

# Endpoint-specific limits
spring.security.rate-limiting.upload-endpoint=5
spring.security.rate-limiting.auth-endpoint=5
spring.security.rate-limiting.message-endpoint=30

# ==========================================
# Audit Logging Configuration
# ==========================================

# Enable/disable audit logging
# Default: true (enabled)
spring.security.audit-logging.enabled=true

# MongoDB collection for audit logs
spring.data.mongodb.audit-collection=audit_logs

# Audit log retention (days) - optional
spring.security.audit-logging.retention-days=90

# Sensitive operations to audit
spring.security.audit-logging.sensitive-actions=\
  USER_MANAGEMENT_CREATE,\
  USER_MANAGEMENT_UPDATE,\
  USER_MANAGEMENT_DELETE,\
  SHOP_MANAGEMENT_CREATE,\
  SHOP_MANAGEMENT_UPDATE,\
  SHOP_MANAGEMENT_DELETE,\
  DELETE

# ==========================================
# Request Signing Configuration (HMAC)
# ==========================================

# Enable/disable request signing validation
# Default: false (disabled - optional security feature)
security.request-signing.enabled=false

# Secret key for HMAC-SHA256 signing
# IMPORTANT: Use environment variable in production
# Example: export SIGNING_SECRET="your-random-256bit-key"
security.request-signing.secret=${SIGNING_SECRET:default-secret-key}

# Maximum age of request timestamp (milliseconds)
# Default: 5 minutes (300000 ms)
security.request-signing.max-timestamp-diff=300000

# Endpoints requiring request signing (comma-separated)
security.request-signing.protected-endpoints=\
  /api/users/delete,\
  /api/shops/delete,\
  /api/admin/*,\
  /api/auth/signup

# ==========================================
# IP Whitelisting Configuration
# ==========================================

# Enable/disable IP whitelisting
# Default: false (disabled)
security.ip-whitelist.enabled=false

# Whitelist of allowed IP addresses (comma-separated)
# Supports: single IPs, CIDR notation, hostnames, localhost
security.ip-whitelist.ips=\
  127.0.0.1,\
  localhost,\
  ::1

# Endpoints requiring IP whitelisting (comma-separated)
security.ip-whitelist.paths=\
  /api/admin/,\
  /api/users/

# Allow local connections regardless of whitelist
security.ip-whitelist.allow-localhost=true

# ==========================================
# Fine-Grained Permissions Configuration
# ==========================================

# Enable/disable fine-grained permission checking
# Default: true (enabled)
spring.security.fine-grained-permissions.enabled=true

# Permission evaluation strategy
# Options: ROLE_BASED, RESOURCE_BASED, HYBRID (default)
spring.security.fine-grained-permissions.strategy=HYBRID

# Cache permissions in memory (improves performance)
spring.security.fine-grained-permissions.cache.enabled=true
spring.security.fine-grained-permissions.cache.ttl=300

# ==========================================
# Security Headers
# ==========================================

# Strict Transport Security (HTTPS)
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true

# Content Security Policy
security.headers.csp=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'

# X-Content-Type-Options
security.headers.x-content-type-options=nosniff

# X-Frame-Options
security.headers.x-frame-options=DENY

# ==========================================
# Logging Configuration for Security Events
# ==========================================

# Log level for security components
logging.level.com.example.socialmedia.security=INFO
logging.level.com.example.socialmedia.audit=DEBUG
logging.level.org.springframework.security=WARN

# Log failed authentication attempts
logging.level.org.springframework.security.authentication=WARN

# ==========================================
# JWT Configuration
# ==========================================

# JWT secret key (environment variable)
app.jwtSecret=${JWT_SECRET:your-super-secret-key-change-in-production}

# JWT expiration time (milliseconds)
# Default: 24 hours (86400000 ms)
app.jwtExpirationMs=86400000

# ==========================================
# MongoDB Configuration for Audit Logs
# ==========================================

# MongoDB connection string
spring.data.mongodb.uri=mongodb://localhost:27017/social_media

# MongoDB auto index creation
spring.data.mongodb.auto-index-creation=true

# ==========================================
# Database Configuration
# ==========================================

# H2 Database
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# Datasource
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# ==========================================
# Actuator Configuration
# ==========================================

# Enable actuator endpoints for monitoring
management.endpoints.web.exposure.include=health,metrics,env
management.endpoint.health.show-details=when-authorized

# ==========================================
# CORS Configuration
# ==========================================

# Allowed origins
spring.web.cors.allowed-origins=http://localhost:3000,http://localhost:3001

# Allowed methods
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH

# Allowed headers
spring.web.cors.allowed-headers=*

# Allow credentials
spring.web.cors.allow-credentials=true

# Max age (seconds)
spring.web.cors.max-age=3600

# ==========================================
# Server Configuration
# ==========================================

# Server port
server.port=8080

#Server servlet context path
server.servlet.context-path=/

# Connection timeout
server.tomcat.connection-timeout=20000

# Thread configuration
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# ==========================================
# Fetures Toggle
# ==========================================

# Enable advanced security features
app.features.rate-limiting=true
app.features.audit-logging=true
app.features.request-signing=false
app.features.ip-whitelisting=false
app.features.fine-grained-permissions=true

# Environment profile
spring.profiles.active=default
